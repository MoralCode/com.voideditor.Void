app-id: com.voideditor.Void
runtime: org.freedesktop.Sdk
runtime-version: "24.08"
sdk: org.freedesktop.Sdk
command: com.voideditor.Void
base: org.electronjs.Electron2.BaseApp
base-version: "24.08"
finish-args:
  - --share=ipc
  - --socket=wayland
  - --socket=x11
  # GPU acceleration
  - --device=dri
  # Audio
  - --socket=pulseaudio
  - --socket=ssh-auth
  # Network access - Cursor needs this for its AI features
  - --share=network
  - --persist=.vscode-oss
  - --allow=devel
  - --talk-name=org.freedesktop.secrets
  - --talk-name=org.kde.kwalletd5
  - --talk-name=org.freedesktop.Flatpak
  - --env=XCURSOR_PATH=/run/host/user-share/icons:/run/host/share/icons
  - --filesystem=xdg-run/gnupg:ro
  - --filesystem=xdg-config/kdeglobals:ro
  - --talk-name=com.canonical.AppMenu.Registrar
  - --system-talk-name=org.freedesktop.login1
  # Unsure
  - --talk-name=org.freedesktop.Notifications

modules:
  # Module for the Cursor application itself
  # - shared-modules/libcanberra/libcanberra.json
  - name: void
    buildsystem: simple
    build-commands:
      - mkdir -p /app/void
      # Copy the extracted tarball contents into the /app directory
      - cp -r void-linux-x64/bin /app/void/bin
      # - chmod +x /app/bin/void
      - cp -r void-linux-x64/locales /app/void/locales
      - cp -r void-linux-x64/resources /app/share/void/
      - cp -r void-linux-x64/* /app/void/
      - mkdir -p /app/share/void/
      - cp -r void-linux-x64/resources /app/share/void/resources

      - ln -s /app/void/void /app/share/void/com.voideditor.Void


      # Install metadata files
      - install -Dm644 com.voideditor.Void.desktop /app/share/applications/com.voideditor.Void.desktop
      - install -Dm644 com.voideditor.Void.appdata.xml /app/share/metainfo/com.voideditor.Void.appdata.xml
      - mkdir -p /app/share/icons/hicolor/256x256/apps
      - ffmpeg -width 256 -i void-linux-x64/resources/app/resources/linux/code.png -vf scale=256:-1 -frames:v 1 /app/share/icons/hicolor/256x256/apps/com.voideditor.Void.png
    sources:
      - type: archive
        dest-filename: void-linux-x64.tar.gz
        url: https://github.com/voideditor/binaries/releases/download/1.99.30044/Void-linux-x64-1.99.30044.tar.gz
        sha256: 7beb974b52716be77397e420e0c103625ed7145365393ecef7aa160766c06a04
        dest: void-linux-x64
        # x-checker-data:
        #   type: rotating-url
        #   url: https://www.cursor.com/download/stable/linux-x64
        #   dest-filename: Cursor.AppImage
      # These are the metadata files from our project directory
      - type: file
        path: com.voideditor.Void.desktop
      - type: file
        path: com.voideditor.Void.appdata.xml
      - type: file
        path: run.sh

  - name: wrapper-flatpak-wrapper
    buildsystem: meson
    config-opts:
      - -Deditor_binary=/app/share/void/com.voideditor.Void
      - >-
        -Deditor_args=[
        '/app/share/void/resources/app/out/cli.js',
        '--extensions-dir', '$XDG_DATA_HOME/void/extensions'
        ]
      - -Dprogram_name=com.voideditor.Void
      - -Deditor_title=Void
      - -Dzypak=enabled
      - -Dzypak_args=[ 'host', '-' ]
      - >-
        -Denvs=[
        "ELECTRON_RUN_AS_NODE=1"
        ]
      - >-
        -Denvs_inner=[
        "ZYPAK_SPAWN_LATEST_ON_REEXEC=0",
        ]
      - -Dfirst_run_template=README.md
      # - -Dsdk_update_template=sdk_update.md
      - -Dflagfile_prefix=flatpak-void
    sources:
      - type: git
        url: https://github.com/flathub-infra/ide-flatpak-wrapper.git
        commit: c26e15940a02b40603ea57b0ac76b4944bee5464